openapi: 3.0.0
info:
  title: Rerekisho Reaction API
  version: 1.0.0

tags:
  - name: ログイン前API
    description: 未ログインユーザが利用可能なAPI群
  - name: ログイン後API
    description: ログイン中ユーザが利用可能なAPI群

security:
  - cookieAuth: []

paths:
  /api/auth/signup:
    post:
      summary: ユーザ新規登録
      tags:
        - ログイン前API
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthenticationDataWithAgreement'
      responses:
        '200':
          headers:
            Set-Cookie:
              description: ログインセッション用Cookie
              schema:
                type: string
              example: connect.sid=session-id.prism-mock-id; Path=/; HttpOnly; SameSite=Lax;
          $ref: '#/components/responses/Success'
        '400':
          $ref: '#/components/responses/Error'
        '409':
          description: ユーザID重複エラー
          content:
            application/json:
              schema:
                type: object
                required:
                  - code
                  - message
                  - ok
                properties:
                  code:
                    type: integer
                    example: 409
                  message:
                    type: string
                    example: "指定されたユーザIDは既に使用されています。"
                  ok:
                    type: boolean
                    example: false
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/auth/signin:
    post:
      summary: ユーザログイン
      tags:
        - ログイン前API
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthenticationData'
      responses:
        '200':
          headers:
            Set-Cookie:
              description: ログインセッション用Cookie
              schema:
                type: string
              example: connect.sid=session-id.prism-mock-id; Path=/; HttpOnly; SameSite=Lax;
          $ref: '#/components/responses/Success'
        '400':
          $ref: '#/components/responses/Error'
        '401':
          description: ログイン失敗
          content:
            application/json:
              schema:
                type: object
                required:
                  - code
                  - message
                  - ok
                properties:
                  code:
                    type: integer
                    example: 401
                  message:
                    type: string
                    example: "パスワードが一致しませんでした。"
                  ok:
                    type: boolean
                    example: false
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/auth/signout:
    post:
      summary: ユーザログアウト
      tags:
        - ログイン後API
      responses:
        '200':
          headers:
            Set-Cookie:
              description: ログインセッション用Cookieの削除
              schema:
                type: string
              example: connect.sid=; Path=/; Max-Age=0; HttpOnly; SameSite=Lax;
          $ref: '#/components/responses/Success'
        '400':
          $ref: '#/components/responses/Error'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/auth/me:
    get:
      summary: ログイン中のユーザ情報取得
      tags:
        - ログイン後API
      responses:
        '200':
          description: ログイン中のユーザ情報
          content:
            application/json:
              schema:
                type: object
                required:
                  - username
                  - ok
                properties:
                  username:
                    type: string
                    example: "username123"
                  ok:
                    type: boolean
                    example: true
        '400':
          $ref: '#/components/responses/Error'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      summary: ユーザアカウント削除
      tags:
        - ログイン後API
      responses:
        '200':
          headers:
            Set-Cookie:
              description: ログインセッション用Cookieの削除
              schema:
                type: string
              example: connect.sid=; Path=/; Max-Age=0; HttpOnly; SameSite=Lax;
          $ref: '#/components/responses/Success'
        '400':
          $ref: '#/components/responses/Error'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/resumes:
    get:
      summary: ログイン中ユーザの履歴書一覧の取得
      tags:
        - ログイン後API
      responses:
        '200':
          description: 一覧画面表示用に絞られた履歴書オブジェクトの配列
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ResumeListItem'
        '400':
          $ref: '#/components/responses/Error'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      summary: 履歴書データの新規作成・更新の共通エンドポイント
      description: idが存在しない場合は新規作成、存在する場合は更新を行います
      tags:
        - ログイン後API
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResumeObj'
      responses:
        '200':
          $ref: '#/components/responses/SuccessWithResumeIdAndUpdatedAt'
        '400':
          $ref: '#/components/responses/Error'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/resumes/{resumeId}:
    get:
      summary: 履歴書IDに紐づく履歴書データの取得
      tags:
        - ログイン後API
      parameters:
        - name: resumeId
          in: path
          required: true
          schema:
            type: string
          description: 取得対象の履歴書ID
      responses:
        '200':
          description: 指定された履歴書IDに紐づく履歴書データ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResumeObj'
        '400':
          $ref: '#/components/responses/Error'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      summary: 履歴書IDを指定して、履歴書データを削除
      tags:
        - ログイン後API
      parameters:
        - name: resumeId
          in: path
          required: true
          schema:
            type: string
          description: 削除対象の履歴書ID
      responses:
        '200':
          $ref: '#/components/responses/SuccessWithResumeId'
        '400':
          $ref: '#/components/responses/Error'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: connect.sid
  schemas:
    AuthenticationData:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          example: "username123"
        password:
          type: string
          example: "password123"
    AuthenticationDataWithAgreement:
      allOf:
        - $ref: '#/components/schemas/AuthenticationData'
        - type: object
          required:
            - agreement
          properties:
            agreement:
              type: boolean
              example: true
    ResumeListItem:
      type: object
      required:
        - id
        - name
        - isPublished
        - updatedAt
      properties:
        id:
          type: string
          example: "sample1"
        name:
          type: string
          example: "新規履歴書1"
        isPublished:
          type: boolean
          example: false
        updatedAt:
          type: string
          format: date-time
          example: "2026-01-03T12:00:00Z"
    ResumeObj:
      type: object
      required:
        - id
        - name
        - isPublished
        - isGenderVisible
        - isContactVisible
        - updatedAt
        - values
      properties:
        id:
          type: string
          example: "sample"
        name:
          type: string
          example: "新規履歴書"
        isPublished:
          type: boolean
          example: false
        isGenderVisible:
          type: boolean
          example: true
        isContactVisible:
          type: boolean
          example: true
        updatedAt:
          type: string
          format: date-time
          example: "2026-01-04T12:00:00Z"
        values:
          type: object
          required:
            - displayDate
            - name
            - nameRuby
            - familyName
            - familyNameRuby
            - birthdate
            - gender
            - photoImg
            - address
            - contactAddress
            - educations
            - experiences
            - certifications
            - customs
          properties:
            displayDate:
              type: string
              example: "2026-01-01"
            name:
              type: string
              example: "花子"
            nameRuby:
              type: string
              example: "はなこ"
            familyName:
              type: string
              example: "山田"
            familyNameRuby:
              type: string
              example: "やまだ"
            birthdate:
              type: string
              example: "2000-01-01"
            gender:
              type: string
              example: "女"
            photoImg:
              type: string
              example: ""
            address:
              type: object
              required:
                - postalCode
                - line1
                - line2
                - line1Ruby
                - line2Ruby
                - tel
                - email
              properties:
                postalCode:
                  type: string
                  example: "0010001"
                line1:
                  type: string
                  example: "xx県xx区xxx-xx"
                line2:
                  type: string
                  example: "マンション名xx号室"
                line1Ruby:
                  type: string
                  example: "xxけんxxくxxx-xx"
                line2Ruby:
                  type: string
                  example: "マンションxxごうしつ"
                tel:
                  type: string
                  example: "001-0000-0000"
                email:
                  type: string
                  example: "example@example.com"
            contactAddress:
              type: object
              required:
                - postalCode
                - line1
                - line2
                - line1Ruby
                - line2Ruby
                - tel
                - email
              properties:
                postalCode:
                  type: string
                  example: "0010001"
                line1:
                  type: string
                  example: "xx県xx区xxx-xx"
                line2:
                  type: string
                  example: "マンション名xx号室"
                line1Ruby:
                  type: string
                  example: "xxけんxxくxxx-xx"
                line2Ruby:
                  type: string
                  example: "マンションxxごうしつ"
                tel:
                  type: string
                  example: "001-0000-0000"
                email:
                  type: string
                  example: "example@example.com"
            educations:
              type: object
              required:
                - ids
                - entities
              properties:
                ids:
                  type: array
                  items:
                    type: string
                  example: ["edu_1", "edu_2"]
                entities:
                  type: object
                  additionalProperties:
                    type: object
                    required:
                      - year
                      - month
                      - content
                    properties:
                      year:
                        type: string
                      month:
                        type: string
                      content:
                        type: string
                  example:
                    edu_1:
                      year: "2000"
                      month: "4"
                      content: "学歴x"
                    edu_2:
                      year: "2004"
                      month: "3"
                      content: "学歴xx"
            experiences:
              type: object
              required:
                - ids
                - entities
              properties:
                ids:
                  type: array
                  items:
                    type: string
                  example: ["exp_1", "exp_2"]
                entities:
                  type: object
                  additionalProperties:
                    type: object
                    required:
                      - year
                      - month
                      - content
                    properties:
                      year:
                        type: string
                      month:
                        type: string
                      content:
                        type: string
                  example:
                    exp_1:
                      year: "2004"
                      month: "4"
                      content: "職歴x"
                    exp_2:
                      year: "2006"
                      month: "3"
                      content: "職歴xx"
            certifications:
              type: object
              required:
                - ids
                - entities
              properties:
                ids:
                  type: array
                  items:
                    type: string
                  example: ["cert_1", "cert_2"]
                entities:
                  type: object
                  additionalProperties:
                    type: object
                    required:
                      - year
                      - month
                      - content
                    properties:
                      year:
                        type: string
                      month:
                        type: string
                      content:
                        type: string
                  example:
                    cert_1:
                      year: "2005"
                      month: "5"
                      content: "資格x"
                    cert_2:
                      year: "2007"
                      month: "6"
                      content: "資格xx"
            customs:
              type: object
              required:
                - ids
                - entities
              properties:
                ids:
                  type: array
                  items:
                    type: string
                  example: ["cus_1", "cus_2"]
                entities:
                  type: object
                  additionalProperties:
                    type: object
                    required:
                      - label
                      - content
                    properties:
                      label:
                        type: string
                      content:
                        type: string
                  example:
                    cus_1:
                      label: "志望の動機、特技、好きな学科、アピールポイントなど"
                      content: "xxxxxxxxxxxx"
                    cus_2:
                      label: "本人希望記入欄（特に給料・職種・勤務時間・勤務地・その他についての希望などがあれば記入）"
                      content: "xxxxxxxxxxxx"
    SuccessResponse:
      type: object
      required:
        - message
        - ok
      properties:
        message:
          type: string
        ok:
          type: boolean
    SuccessResponseWithResumeId:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          required:
            - resumeId
          properties:
            resumeId:
              type: string
    SuccessResponseWithResumeIdAndUpdatedAt:
      allOf:
        - $ref: '#/components/schemas/SuccessResponseWithResumeId'
        - type: object
          required:
            - updatedAt
          properties:
            updatedAt:
              type: string
              format: date-time
    ErrorResponse:
      type: object
      required:
        - code
        - message
        - ok
      properties:
        code:
          type: integer
        message:
          type: string
        ok:
          type: boolean
  responses:
    Success:
      description: 成功レスポンス
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/SuccessResponse'
          example:
            message: "正常に完了しました。"
            ok: true
    SuccessWithResumeId:
      description: 成功レスポンス（履歴書ID付き）
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/SuccessResponseWithResumeId'
          example:
            message: "正常に完了しました。"
            resumeId: "sample1"
            ok: true
    SuccessWithResumeIdAndUpdatedAt:
      description: 成功レスポンス（履歴書IDと更新日時付き）
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/SuccessResponseWithResumeIdAndUpdatedAt'
          example:
            message: "正常に完了しました。"
            resumeId: "sample1"
            ok: true
            updatedAt: "2026-01-05T12:00:00Z"
    UnauthorizedError:
      description: 認証失敗
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: 401
            message: "要求された操作にはログインが必要です。"
            ok: false
    Error:
      description: 汎用的なエラーレスポンス
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: 400
            message: "不正なリクエストです。"
            ok: false
    InternalServerError:
      description: サーバー内部エラー
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: 500
            message: "サーバー内部でエラーが発生しました。"
            ok: false
